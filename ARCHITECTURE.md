# NetEZ æ¶æ„è®¾è®¡ä¸ç±»è°ƒç”¨å…³ç³»

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ NetEZ å„ä¸ªç±»çš„è°ƒç”¨å…³ç³»å’Œä½¿ç”¨åœºæ™¯ã€‚

## ğŸ“Š æ¨èå›¾è¡¨ç±»å‹

### 1. æ•´ä½“æ¶æ„åˆ†å±‚å›¾
å±•ç¤ºç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„ï¼Œç†è§£å„æ¨¡å—çš„èŒè´£è¾¹ç•Œã€‚

### 2. æœåŠ¡å™¨ç«¯å¤„ç†æµç¨‹å›¾
å±•ç¤ºä»å®¢æˆ·ç«¯è¿æ¥åˆ°æ¶ˆæ¯å¤„ç†çš„å®Œæ•´æµç¨‹ã€‚

### 3. å®¢æˆ·ç«¯å¤„ç†æµç¨‹å›¾
å±•ç¤ºå®¢æˆ·ç«¯å¦‚ä½•è¿æ¥æœåŠ¡å™¨ã€å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚

### 4. æ ¸å¿ƒç±»å…³ç³»å›¾
å±•ç¤ºç±»ä¹‹é—´çš„ä¾èµ–å’Œç»„åˆå…³ç³»ã€‚

### 5. æ¶ˆæ¯å¤„ç†æ—¶åºå›¾
å±•ç¤ºå¯¹è±¡é—´çš„äº¤äº’é¡ºåºã€‚

---

## 1ï¸âƒ£ æ•´ä½“æ¶æ„åˆ†å±‚å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Application)                     â”‚
â”‚                    ä½ çš„ä¸šåŠ¡é€»è¾‘ä»£ç                             â”‚
â”‚          â†“ æ³¨å†Œäº‹ä»¶å›è°ƒ                    â†‘ è§¦å‘äº‹ä»¶          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     äº‹ä»¶å±‚ (Event Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ServerEvents.cs / ClientEvents.cs                    â”‚  â”‚
â”‚  â”‚ â€¢ OnClientConnectedEvent                             â”‚  â”‚
â”‚  â”‚ â€¢ OnClientReceivedEvent                              â”‚  â”‚
â”‚  â”‚ â€¢ OnClientDisconnectedEvent                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ ¸å¿ƒæœåŠ¡å±‚ (Service Layer)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  TcpServiceBase     â”‚        â”‚  TcpClientBase      â”‚    â”‚
â”‚  â”‚  â€¢ æœåŠ¡å™¨ä¸»æ§åˆ¶å™¨    â”‚        â”‚  â€¢ å®¢æˆ·ç«¯ä¸»æ§åˆ¶å™¨    â”‚    â”‚
â”‚  â”‚  â€¢ æ¥å—è¿æ¥         â”‚        â”‚  â€¢ è¿æ¥æœåŠ¡å™¨        â”‚    â”‚
â”‚  â”‚  â€¢ å®¢æˆ·ç«¯ç®¡ç†       â”‚        â”‚  â€¢ å‘é€/æ¥æ”¶æ•°æ®     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                              â”‚                   â”‚
â”‚           â”œâ”€ TcpClientManager            â”œâ”€ TcpClientPool   â”‚
â”‚           â”‚  (æœåŠ¡ç«¯å®¢æˆ·ç«¯ç®¡ç†å™¨)         â”‚  (è¿æ¥æ± )         â”‚
â”‚           â””â”€ ServerStat                  â””â”€ ClientStatus    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åè®®è§£æå±‚ (Protocol Layer)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IProtocolParser (æ¥å£)                               â”‚  â”‚
â”‚  â”‚    â†“ å®ç°                      â†“ å®ç°                â”‚  â”‚
â”‚  â”‚ JMPParser                  PureTextParser            â”‚  â”‚
â”‚  â”‚ â€¢ è§£æ JSON æ¶ˆæ¯            â€¢ è§£æçº¯æ–‡æœ¬æ¶ˆæ¯          â”‚  â”‚
â”‚  â”‚ â€¢ Pack/Unpack              â€¢ Pack/Unpack            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      IO å±‚ (IO Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ BinaryIOBuffer                                       â”‚  â”‚
â”‚  â”‚ â€¢ TCP ç²˜åŒ…å¤„ç†                                       â”‚  â”‚
â”‚  â”‚ â€¢ æ¶ˆæ¯è¾¹ç•Œæ£€æµ‹                                       â”‚  â”‚
â”‚  â”‚ â€¢ ç¼“å†²åŒºç®¡ç†                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SocketAsyncEventArgsPool                             â”‚  â”‚
â”‚  â”‚ â€¢ SAEA å¯¹è±¡æ±                                         â”‚  â”‚
â”‚  â”‚ â€¢ å‡å°‘ GC å‹åŠ›                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   .NET Socket (åº•å±‚)                         â”‚
â”‚                 SocketAsyncEventArgs                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨åœºæ™¯**ï¼šç”¨äºç†è§£ç³»ç»Ÿæ•´ä½“ç»“æ„å’Œæ•°æ®æµå‘ã€‚

---

## 2ï¸âƒ£ æœåŠ¡å™¨ç«¯å¤„ç†æµç¨‹å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  åº”ç”¨ç¨‹åºå¯åŠ¨     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TcpServiceBase   â”‚
                    â”‚ .Start()         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ InitService()                   â”‚
            â”‚ â€¢ åˆ›å»º SAEA å¯¹è±¡æ±               â”‚
            â”‚ â€¢ åˆ›å»ºæ¶ˆæ¯å¤„ç†çº¿ç¨‹æ±             â”‚
            â”‚ â€¢ åˆ›å»ºå®¢æˆ·ç«¯ç®¡ç†å­—å…¸            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ StartAccept()                  â”‚
            â”‚ â€¢ ç›‘å¬ç«¯å£                     â”‚
            â”‚ â€¢ å¼‚æ­¥æ¥å—è¿æ¥                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å®¢æˆ·ç«¯è¿æ¥åˆ°æ¥           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Accept_IO_Completed()              â”‚
        â”‚ â€¢ ä» SAEA æ± è·å–å¯¹è±¡               â”‚
        â”‚ â€¢ åˆ›å»º TcpClientManager            â”‚
        â”‚ â€¢ è§¦å‘ OnClientConnectedEvent      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ TcpClientManager.StartReceive()    â”‚
        â”‚ â€¢ å¼€å§‹å¼‚æ­¥æ¥æ”¶æ•°æ®                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ•°æ®åˆ°è¾¾                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ProcessReceive()                   â”‚
        â”‚ â€¢ æ•°æ®å†™å…¥ BinaryIOBuffer          â”‚
        â”‚ â€¢ æ£€æµ‹å®Œæ•´æ¶ˆæ¯                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ¶ˆæ¯å®Œæ•´ï¼Ÿ                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
            NO â”‚                      YESâ”‚
               â†“                         â†“
        ç»§ç»­æ¥æ”¶æ•°æ®        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—             â”‚
                           â”‚ ConcurrentQueue         â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ é€šçŸ¥æ¶ˆæ¯å¤„ç†çº¿ç¨‹         â”‚
                           â”‚ AutoResetEvent.Set()    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ MessageProcingLoop() [çº¿ç¨‹æ± ]   â”‚
                    â”‚ â€¢ ä»é˜Ÿåˆ—å–å‡ºæ¶ˆæ¯                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ IProtocolParser.Parse()          â”‚
                    â”‚ â€¢ JMPParser æˆ– PureTextParser    â”‚
                    â”‚ â€¢ è§£æä¸º IMessage å¯¹è±¡           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ è§¦å‘ OnClientReceivedEvent       â”‚
                    â”‚ â†’ åº”ç”¨å±‚ä¸šåŠ¡é€»è¾‘                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ SendMessageToClient()            â”‚
                    â”‚ â€¢ åè®®æ‰“åŒ…                       â”‚
                    â”‚ â€¢ å¼‚æ­¥å‘é€å“åº”                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç±»è°ƒç”¨é¡ºåº**ï¼š
```
TcpServiceBase
  â†’ SocketAsyncEventArgsPool (è·å– SAEA)
  â†’ TcpClientManager (åˆ›å»ºå®¢æˆ·ç«¯ç®¡ç†å™¨)
  â†’ BinaryIOBuffer (å¤„ç†æ•°æ®)
  â†’ ConcurrentQueue (æ¶ˆæ¯é˜Ÿåˆ—)
  â†’ IProtocolParser (åè®®è§£æ)
  â†’ åº”ç”¨å±‚å›è°ƒ
```

---

## 3ï¸âƒ£ å®¢æˆ·ç«¯å¤„ç†æµç¨‹å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  åº”ç”¨ç¨‹åºå¯åŠ¨     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TcpClientBase    â”‚
                    â”‚ æˆ– TcpClientPool â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ ConnectServerAsync()            â”‚
            â”‚ â€¢ åˆ›å»º Socket                   â”‚
            â”‚ â€¢ å¼‚æ­¥è¿æ¥æœåŠ¡å™¨                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ è¿æ¥æˆåŠŸ                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ StartReceive()                     â”‚
        â”‚ â€¢ å¼€å§‹å¼‚æ­¥æ¥æ”¶æ•°æ®                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
        â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é€æ•°æ®æµç¨‹      â”‚    â”‚ æ¥æ”¶æ•°æ®æµç¨‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SendMessageAsync()   â”‚  â”‚ ProcessReceive()     â”‚
â”‚ â€¢ åè®®æ‰“åŒ…          â”‚  â”‚ â€¢ æ•°æ®å†™å…¥ Buffer    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IProtocolParser      â”‚  â”‚ BinaryIOBuffer       â”‚
â”‚ .Pack()             â”‚  â”‚ â€¢ æ£€æµ‹å®Œæ•´æ¶ˆæ¯       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SendBytesAsync()     â”‚  â”‚ æ¶ˆæ¯å®Œæ•´ï¼Ÿ           â”‚
â”‚ â€¢ å¼‚æ­¥å‘é€          â”‚  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   NOâ”‚             YESâ”‚
                            â†“                â†“
                    ç»§ç»­æ¥æ”¶    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ IProtocolParser  â”‚
                                â”‚ .Parse()        â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â†“
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ è§¦å‘æ¥æ”¶å›è°ƒ     â”‚
                                â”‚ â†’ åº”ç”¨å±‚å¤„ç†     â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç±»è°ƒç”¨é¡ºåº**ï¼š
```
TcpClientBase/TcpClientPool
  â†’ Socket (è¿æ¥)
  â†’ IProtocolParser.Pack() (å‘é€)
  â†’ BinaryIOBuffer (æ¥æ”¶)
  â†’ IProtocolParser.Parse() (è§£æ)
  â†’ åº”ç”¨å±‚å›è°ƒ
```

---

## 4ï¸âƒ£ æ ¸å¿ƒç±»å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        IService (æ¥å£)                        â”‚
â”‚  + Start() : bool                                            â”‚
â”‚  + Stop() : void                                             â”‚
â”‚  + RegisterMessageParser(IProtocolParser)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–³ å®ç°
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TcpServiceBase                            â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  - _Clients : ConcurrentDictionary<long, TcpClientManager>  â”‚
â”‚  - _MessageParser : IProtocolParser                          â”‚
â”‚  - _SaeaReadPool : SocketAsyncEventArgsPool                  â”‚
â”‚  - _SaeaWritePool : SocketAsyncEventArgsPool                 â”‚
â”‚  - _ClientMessageQueues : ConcurrentQueue[]                  â”‚
â”‚  - _MessageProcThreadPool : Thread[]                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  + Start() : bool                                            â”‚
â”‚  + Stop() : void                                             â”‚
â”‚  + SendMessageToClient(clientId, message)                    â”‚
â”‚  # InitService() : bool                                      â”‚
â”‚  # StartAccept(saea)                                         â”‚
â”‚  # Accept_IO_Completed(sender, e)                            â”‚
â”‚  # MessageProcingLoop(queueIndex)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ åŒ…å«        â”‚ ä½¿ç”¨                  â”‚ ä½¿ç”¨
           â†“             â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚TcpClientManager  â”‚ â”‚IProtocolParser   â”‚ â”‚SocketAsyncEvent   â”‚
â”‚                  â”‚ â”‚    (æ¥å£)        â”‚ â”‚     ArgsPool      â”‚
â”‚- _Socket         â”‚ â”‚      â–³           â”‚ â”‚                   â”‚
â”‚- _ReadSaea       â”‚ â”‚      â”‚ å®ç°     â”‚ â”‚- _Pool : Stack    â”‚
â”‚- _PartialBuffer  â”‚ â”‚   â”Œâ”€â”€â”´â”€â”€â”€â”€â”     â”‚ â”‚+ Pop() : SAEA    â”‚
â”‚- _Status         â”‚ â”‚   â”‚       â”‚     â”‚ â”‚+ Push(SAEA)      â”‚
â”‚- _LastRecvTime   â”‚ â”‚JMPParser  â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                  â”‚ â”‚PureText   â”‚     â”‚
â”‚+ StartReceive()  â”‚ â”‚  Parser   â”‚     â”‚
â”‚+ ProcessReceive()â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚+ SendMessage()   â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
         â”‚ ä½¿ç”¨                         â”‚
         â†“                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚ BinaryIOBuffer   â”‚                    â”‚
â”‚                  â”‚                    â”‚
â”‚- _Buffer : byte[]â”‚                    â”‚
â”‚- _Offset : int   â”‚                    â”‚
â”‚- _Length : int   â”‚                    â”‚
â”‚                  â”‚                    â”‚
â”‚+ TryReadMessage()â”‚                    â”‚
â”‚+ AppendData()    â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚ ä½¿ç”¨
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TcpClientBase                    â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  - _Socket : Socket                          â”‚
â”‚  - _Parser : IProtocolParser                 â”‚
â”‚  - _RecvBuffer : BinaryIOBuffer              â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  + ConnectServerAsync() : Task               â”‚
â”‚  + SendMessageAsync(message) : Task          â”‚
â”‚  # ProcessReceive()                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–³ è¢«ä½¿ç”¨
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TcpClientPool                    â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  - _ClientPool : ConcurrentBag<TcpClientBase>â”‚
â”‚  - _MaxConnections : int                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  + GetClientAsync() : Task<TcpClientBase>    â”‚
â”‚  + ReleaseClient(client)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç±»ä¹‹é—´çš„å…³ç³»**ï¼š
- **ç»„åˆå…³ç³»** (â—†â†’): TcpServiceBase åŒ…å« TcpClientManagerã€SocketAsyncEventArgsPool
- **ä½¿ç”¨å…³ç³»** (â†’): TcpClientManager ä½¿ç”¨ BinaryIOBuffer
- **å®ç°å…³ç³»** (â–³): TcpServiceBase å®ç° IServiceï¼ŒJMPParser å®ç° IProtocolParser
- **ä¾èµ–å…³ç³»** (--â†’): å„ä¸ªç±»ä¾èµ– IProtocolParser æ¥å£

---

## 5ï¸âƒ£ æ¶ˆæ¯å¤„ç†æ—¶åºå›¾

```
åº”ç”¨å±‚          TcpServiceBase    TcpClientManager   æ¶ˆæ¯é˜Ÿåˆ—   æ¶ˆæ¯å¤„ç†çº¿ç¨‹   IProtocolParser   åº”ç”¨å±‚å›è°ƒ
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚   Start()        â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚  åˆ›å»ºçº¿ç¨‹æ±        â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚              â”‚
  â”‚                  â”‚  StartAccept()   â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”           â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚      â”‚ ç›‘å¬ç«¯å£  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚â†â”€â”€â”€â”€â”€â”˜           â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  å®¢æˆ·ç«¯è¿æ¥         â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â†’  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚  åˆ›å»ºå®¢æˆ·ç«¯ç®¡ç†å™¨ â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚ StartReceive()            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”       â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚      â”‚       â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â†â”€â”€â”€â”€â”€â”˜       â”‚            â”‚               â”‚              â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  å®¢æˆ·ç«¯å‘é€æ•°æ®     â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â†’  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚ Receiveå®Œæˆ  â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”       â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚      â”‚ æ•°æ®  â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚      â”‚å†™å…¥   â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚      â”‚Buffer â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â†â”€â”€â”€â”€â”€â”˜       â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚ æ¶ˆæ¯å®Œæ•´     â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚ Enqueue    â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚â”€â”€â”€â”€â”€â”€â”     â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚â†â”€â”€â”€â”€â”€â”˜     â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚ Signal.Set()               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚ Dequeue       â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚â”€â”€â”€â”€â”€â”€â”        â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚â†â”€â”€â”€â”€â”€â”˜        â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚ Parse(bytes)  â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚ è§£ææ¶ˆæ¯     â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚  IMessage     â”‚â†â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚  è§¦å‘ OnClientReceivedEvent     â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚ å¤„ç†ä¸šåŠ¡
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚â”€â”€â”€â”€â”€â”€â”
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚â†â”€â”€â”€â”€â”€â”˜
  â”‚  SendMessage     â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                  â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚  SendMessageToClient()          â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚              â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚ SendAsync()  â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”       â”‚            â”‚               â”‚              â”‚
  â”‚                  â”‚                  â”‚â†â”€â”€â”€â”€â”€â”˜       â”‚            â”‚               â”‚              â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  å‘é€åˆ°å®¢æˆ·ç«¯       â”‚                  â”‚              â”‚            â”‚               â”‚              â”‚
  â†â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“‹ ç±»çš„è°ƒç”¨åœºæ™¯é€ŸæŸ¥è¡¨

| ç±»å | ä½•æ—¶è¢«è°ƒç”¨ | è°ƒç”¨è€… | ä¸»è¦èŒè´£ |
|-----|-----------|--------|---------|
| **TcpServiceBase** | åº”ç”¨å¯åŠ¨æ—¶ | åº”ç”¨å±‚ | æœåŠ¡å™¨ä¸»æ§åˆ¶ï¼Œç®¡ç†æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ |
| **TcpClientManager** | å®¢æˆ·ç«¯è¿æ¥æ—¶ | TcpServiceBase | ç®¡ç†å•ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€æ¥æ”¶ã€å‘é€ |
| **SocketAsyncEventArgsPool** | æœåŠ¡å™¨åˆå§‹åŒ–æ—¶ | TcpServiceBase | æä¾› SAEA å¯¹è±¡æ± ï¼Œå‡å°‘ GC |
| **BinaryIOBuffer** | æ¥æ”¶åˆ°æ•°æ®æ—¶ | TcpClientManager | å¤„ç† TCP ç²˜åŒ…ï¼Œæ£€æµ‹æ¶ˆæ¯è¾¹ç•Œ |
| **IProtocolParser** | æ¶ˆæ¯å®Œæ•´æ—¶ | æ¶ˆæ¯å¤„ç†çº¿ç¨‹ | è§£æå­—èŠ‚æµä¸ºæ¶ˆæ¯å¯¹è±¡ |
| **JMPParser** | ä½¿ç”¨ JMP åè®®æ—¶ | TcpServiceBase/Client | è§£æ JSON æ¶ˆæ¯åè®® |
| **PureTextParser** | ä½¿ç”¨çº¯æ–‡æœ¬åè®®æ—¶ | TcpServiceBase/Client | è§£æçº¯æ–‡æœ¬æ¶ˆæ¯ |
| **TcpClientBase** | éœ€è¦è¿æ¥æœåŠ¡å™¨æ—¶ | åº”ç”¨å±‚ | å®¢æˆ·ç«¯è¿æ¥ã€å‘é€ã€æ¥æ”¶ |
| **TcpClientPool** | éœ€è¦è¿æ¥å¤ç”¨æ—¶ | åº”ç”¨å±‚ | ç®¡ç†å®¢æˆ·ç«¯è¿æ¥æ±  |
| **ClientMessageContext** | æ¶ˆæ¯åˆ°è¾¾æ—¶ | TcpClientManager | å°è£…å®¢æˆ·ç«¯æ¶ˆæ¯ä¸Šä¸‹æ–‡ |
| **OnClientReceivedEvent** | æ¶ˆæ¯è§£æå®Œæˆå | TcpServiceBase | é€šçŸ¥åº”ç”¨å±‚å¤„ç†æ¶ˆæ¯ |

---

## ğŸ”§ ç»˜å›¾å·¥å…·æ¨è

1. **åœ¨çº¿å·¥å…·**ï¼š
   - [draw.io](https://app.diagrams.net/) - å…è´¹ã€åŠŸèƒ½å¼ºå¤§
   - [Mermaid Live Editor](https://mermaid.live/) - æ”¯æŒä»£ç ç”Ÿæˆå›¾è¡¨
   - [PlantUML Online](http://www.plantuml.com/plantuml/) - UML å›¾ä¸“ç”¨

2. **æ¡Œé¢å·¥å…·**ï¼š
   - Microsoft Visio
   - Lucidchart
   - StarUML

3. **ä»£ç ç”Ÿæˆå›¾è¡¨**ï¼š
   - Mermaid (Markdown é›†æˆ)
   - PlantUML (æ”¯æŒå„ç§ UML å›¾)

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

- **æ–°æ‰‹å…¥é—¨**ï¼šå…ˆçœ‹æ•´ä½“æ¶æ„åˆ†å±‚å›¾ â†’ æœåŠ¡å™¨å¤„ç†æµç¨‹å›¾
- **ç†è§£åè®®**ï¼šçœ‹åè®®è§£ææµç¨‹å’Œç±»å…³ç³»å›¾
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå…³æ³¨å¯¹è±¡æ± ã€çº¿ç¨‹æ± ã€æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨
- **é—®é¢˜æ’æŸ¥**ï¼šå‚è€ƒæ—¶åºå›¾ï¼Œç†è§£æ•°æ®æµè½¬çš„å®Œæ•´é“¾è·¯

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ¦‚è§ˆå’Œå¿«é€Ÿå¼€å§‹
- ä»£ç æ³¨é‡Š - å„ä¸ªç±»çš„è¯¦ç»†è¯´æ˜
