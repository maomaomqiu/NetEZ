# NetEZ 性能测试项目

## 快速开始

### 1. 编译项目

```bash
cd NetEZ.PerformanceTest
dotnet build
```

### 2. 运行完整基准测试

**方式一：自动运行（推荐）**

```bash
dotnet run
# 选择选项 3: 运行完整基准测试
```

这会自动启动服务器并运行一系列基准测试。

**方式二：分别运行服务器和客户端**

终端 1 - 启动服务器:
```bash
dotnet run
# 选择选项 1: 启动服务器
```

终端 2 - 运行压测:
```bash
dotnet run
# 选择选项 2: 运行客户端压测
# 根据提示输入测试参数
```

### 3. 自定义测试

修改 `Program.cs` 中的参数来自定义测试场景。

## 测试场景

默认包含 5 个基准测试场景:

1. **小消息高并发** - 100 客户端 × 1000 消息 × 100 字节
2. **中等消息** - 50 客户端 × 500 消息 × 1KB
3. **大消息** - 20 客户端 × 200 消息 × 10KB
4. **单客户端持续** - 1 客户端 × 10000 消息 × 512 字节
5. **极限并发** - 500 客户端 × 100 消息 × 256 字节

## 输出示例

```
【测试 1】小消息高并发 (100字节)
[Client] 性能测试参数:
  - 并发客户端数: 100
  - 每客户端消息数: 1000
  - 消息大小: 100 字节
  - 总消息数: 100000

========== 性能测试结果 ==========
总耗时: 2.35 秒
发送消息数: 100000
接收消息数: 100000
成功率: 100.00%

QPS (每秒请求数): 42553
吞吐量: 4.06 MB/s

平均延迟: 1.23 ms
最小延迟: 0 ms
最大延迟: 45 ms
=================================
```

## 监控建议

运行测试时，建议使用以下工具监控:

- **Windows**: 任务管理器 或 Performance Monitor
- **Linux**: top, htop, iotop
- **.NET 分析**: dotMemory, dotTrace, PerfView

## 性能调优

如果性能不达预期，检查:

1. 网络配置 (关闭防火墙、使用本地回环)
2. 服务器配置 (`MessageProcessingThreadCount`)
3. 客户端并发数
4. 消息大小和频率
5. GC 频率和耗时
